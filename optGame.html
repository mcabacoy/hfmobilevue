<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="optGame"></div>
<script type="text/javascript" src="https://login.mightypanda88.com/jswrapper/integration.js.php?casino=mightypanda88"></script>
<script type="text/javascript">
  var username = getQueryString('username');
  var password = getQueryString('password');
  var gameCode = getQueryString('gameCode');
  var currentgame = gameCode;
  gametype = type;
  iapiSetCallout('Login', calloutLogin);
  iapiSetCallout('GetTemporaryAuthenticationToken', calloutGetTemporaryAuthenticationToken);
  login();
  function login() {
    iapiSetClientPlatform("mobile&deliveryPlatform=HTML5");
    var realMode = 1;
    iapiLogin(username, password, realMode, "en");
  }

  function askTempandLaunchGame(type, game) {
    currentgame =gameCode;
    gametype = type;
    var realMode = 1;

    iapiRequestTemporaryToken(realMode, '570', 'GamePlay');
  }

  function launchMobileClient(temptoken) {
    if (gametype == "mps") {
      var clientUrl=''+'?username=' + username + '&temptoken=' + temptoken + '&game=' + currentgame + '&real=1';
    } else if (gametype = "ngm") {
      var clientUrl = 'http://hub.mp176588.com/igaming/' + '?gameId=' + currentgame + '&real=1' + '&username=' + username + '&language=zh_cn' + '&tempToken=' + temptoken + '&lobby=https://mobile.galaxyinnovation.com/mightypanda88/lobby.php' + '&support=https://mobile.galaxyinnovation.com/mightypanda88/support.php' + '&logout=https://mobile.galaxyinnovation.com/mightypanda88';
    }
    document.location = clientUrl;
  }

  function calloutLogin(response) {
    if (response.errorCode) {
      alert("Login failed. " + response.playerMessage + " Error code: " + response.errorCode);
    }
    else {
      alert("Login OK, ready to play games");
      window.location = "lobby.html?username=" + username;
    }
  }

  function calloutGetTemporaryAuthenticationToken(response) {
    if (response.errorCode) {
      alert("Token failed. " + response.playerMessage + " Error code: " + response.errorCode);
    }
    else {
      launchMobileClient(response.sessionToken.sessionToken);
    }
  }

  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
      if (pair[0] == variable) {
        return pair[1];
      }
    }
    alert('Query Variable ' + variable + ' not found');
  }
  function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]);
    return null;
  }
</script>
</body>
</html>
